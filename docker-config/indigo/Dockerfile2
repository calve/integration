FROM alpine:3.4

RUN apk add --update python git nodejs
RUN apk add --update --virtual=build-dependencies ca-certificates build-base
RUN update-ca-certificates
RUN cd $(npm root -g)/npm \
 && npm install fs-extra \
 && sed -i -e s/graceful-fs/fs-extra/ -e s/fs\.rename/fs.move/ ./lib/utils/rename.js
RUN npm install npm@latest -g

RUN npm install n -g
RUN npm install -g typings
RUN typings install
RUN npm --versions

RUN npm install webpack webpack-dev-server -g

RUN git config --global url."https://github.com/".insteadOf git@github.com: && \
    git config --global url."https://".insteadOf git://

RUN git clone https://github.com/okgreece/indigo.git app

RUN cd /app && \
    rm -rf node_modules && \
    npm install --only=dev && \
    typings install && \
    npm install --save-dev @types/core-js && \
    npm install typings --saveDev && \
    typings install dt~es6-shim --global --save

EXPOSE 8080

COPY ./start.sh /start.sh
CMD ["/bin/sh", "start.sh"]